---
title: "Characteristics of major storms and weather events in the United States"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,cache=TRUE)
# retirer les output des librairies charg√©es
# library(dplyr)
```

## Abstract



## Data processing

First, we need to download and import the data

```{r dataImport}
download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2","stormData.csv.bz2")
importedstormData <- read.csv("stormData.csv.bz2")
str(importedstormData)
```

The damage columns are not exploitable yet, because the exposant is in another column. We need to create columns with the final value, other values than B, M and K are not significant and can be ignored.

```{r exponentialValuesCleaning}
# preparing data to be cleaned
stormData <- importedstormData
expvalues <- cbind(c("[^BbMmKk]","B","M","K"),c(1,1e+09,1e+06,1e+03))
stormData$PROPDMGEXP <- as.character(stormData$PROPDMGEXP)
stormData$CROPDMGEXP <- as.character(stormData$CROPDMGEXP)

# cleaning any other operator than B M K and replacing it with 1
stormData$PROPDMGEXP <- gsub("[^BbMmKk]","1",stormData$PROPDMGEXP)
stormData$CROPDMGEXP <- gsub("[^BbMmKk]","1",stormData$CROPDMGEXP)

# replaceing the B M K with proper exposant operator
for (i in 1:length(expvalues[,1])){
        print(i)
        stormData$PROPDMGEXP <- gsub(expvalues[i,1],expvalues[i,2],stormData$PROPDMGEXP,ignore.case = TRUE)
        stormData$CROPDMGEXP <- gsub(expvalues[i,1],expvalues[i,2],stormData$CROPDMGEXP,ignore.case = TRUE)
}

# test only :
head(stormData$PROPDMGEXP,100)

# giving the numeric class and getting the final value
stormData$PROPDMG <- as.numeric(stormData$PROPDMG)
stormData$PROPDMGEXP <- as.numeric(stormData$PROPDMGEXP)
stormData$PROPDMGVALUE <- stormData$PROPDMG * stormData$PROPDMGEXP

stormData$CROPDMG <- as.numeric(stormData$CROPDMG)
stormData$CROPDMGEXP <- as.numeric(stormData$CROPDMGEXP)
stormData$CROPDMGVALUE <- stormData$CROPDMG * stormData$CROPDMGEXP
```

## Population health incidence

Let's find which events are the most harmful considering the population health. We will order our data with the "INJURIES" variable. We will then aggregate the result to avoid the doubles.

```{r harmfulInjuries}
stormDataHarmfulInjuries <- aggregate(INJURIES~EVTYPE,stormData,sum)
stormDataHarmfulInjuries <- stormDataHarmfulInjuries[order(-stormDataHarmfulInjuries$INJURIES),]
head(stormDataHarmfulInjuries)
```

That might be interesting to compare it to "FATALITIES"

```{r harmfulFatalities}
stormDataHarmfulFatalities <- aggregate(FATALITIES~EVTYPE,stormData,sum)
stormDataHarmfulFatalities <- stormDataHarmfulFatalities[order(-stormDataHarmfulFatalities$FATALITIES),]
head(stormDataHarmfulFatalities)
```

## Economic incidence

```{r economicConsequences}
stormDataEcoConsequences <- aggregate(PROPDMG~EVTYPE,stormData,sum)
stormDataHarmfulEcoConsequences <- stormDataEcoConsequences[order(-stormDataEcoConsequences$PROPDMG),]
head(stormDataHarmfulEcoConsequences)
```

## Results